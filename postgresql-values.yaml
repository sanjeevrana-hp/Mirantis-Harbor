postgresql:
  replicaCount: 3
  nodeSelector:
    node-role.kubernetes.io/msr: "true"

primary:
  persistence:
    enabled: true
    size: 10Gi
    storageClass: "nfs-client"
  postgresql:
    password: "support"
    replicaCount: 3
    initdbScripts:
      create_databases.sh: |
        #!/bin/bash
        echo "Creating initial databases..."
        export PGPASSWORD=$(cat /opt/bitnami/postgresql/secrets/password)
        psql -U postgres -c "CREATE DATABASE harbor_core" && psql -U postgres -c "CREATE DATABASE notary_signer" && psql -U postgres -c "CREATE DATABASE notary_server"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 256Mi
  readinessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 6
    successThreshold: 1
    exec:
      - sh
      - -c
      - exec pg_isready -U postgres
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - primary
          topologyKey: "kubernetes.io/hostname"
  nodeSelector:
    node-role.kubernetes.io/msr: "true"
